---
title: 'External References'
description: 'Link your workflows to external systems like Stripe, Shopify, and more'
---

**References** link threads to external system identifiers like order IDs, customer IDs, or support tickets. They enable you to query threads using identifiers from your existing systems.

### Reference Types

- **Order IDs** - E-commerce order numbers
- **Customer IDs** - Customer account identifiers  
- **Support Tickets** - Zendesk, Jira, Salesforce ticket numbers
- **Transaction IDs** - Payment processor transaction IDs
- **Application IDs** - Loan applications, insurance claims
- **Custom IDs** - Any business-relevant identifier

### Reference Properties

- **Key** - The reference type (e.g., "order_id")
- **Value** - The actual identifier (e.g., "ORD-789")
- **Thread association** - Links to a specific thread
- **Queryable** - Can be used to find threads

### Adding References

Link workflows to external systems (Stripe, Shopify, etc.):

<CodeGroup>

```javascript JavaScript
const payment = await processStripePayment();

// Add references at thread level
await thread.addRefs({
  stripe_payment_id: payment.id,
  stripe_customer_id: payment.customer,
  order_id: 'ORD-12345'
});

// Then record the step with context
await thread.step('process_payment')
  .addContext({ amount: 299.99, currency: 'USD' })
  .success();
```

```go Go
payment, err := processStripePayment()
if err != nil {
    log.Fatal(err)
}

// Add references at thread level
err = thread.AddRefs(ctx, map[string]string{
    "stripe_payment_id":   payment.ID,
    "stripe_customer_id": payment.Customer,
    "order_id":           "ORD-12345",
})
if err != nil {
    log.Fatal(err)
}

// Then record the step with context
_, err = thread.Step("process_payment").
    AddContext(map[string]any{"amount": 299.99, "currency": "USD"}).
    Success(ctx)
if err != nil {
    log.Fatal(err)
}
```

</CodeGroup>

### Querying by Reference

<CodeGroup>

```javascript JavaScript
const threads = await connection.getThreadsByRef({
  refKey: 'stripe_payment_id',
  refValue: 'pi_1234567890'
});
```

```go Go
threads, err := conn.GetThreadsByRef(ctx, &threadify.RefQuery{
    RefKey:   "stripe_payment_id",
    RefValue: "pi_1234567890",
})
if err != nil {
    log.Fatal(err)
}
```

</CodeGroup>

### Query Options

| Option | Type | Description |
|--------|------|-------------|
| `refKey` | string | Reference key (e.g., 'stripe_payment_id') |
| `refValue` | string | Reference value (e.g., 'pi_123') |
| `status` | string | Filter by thread status |
| `startedAfter` | string | ISO timestamp filter |
| `limit` | number | Max results to return |

### Linking Threads

Link threads together to create relationships:

<CodeGroup>

```javascript JavaScript
// Link to parent thread
await childThread.linkThread(parentThread.threadId, 'parent');

// Link to related thread
await thread.linkThread(relatedThread.threadId, 'related');

// Link to child thread
await parentThread.linkThread(childThread.threadId, 'child');
```

```go Go
// Link to parent thread
err := childThread.LinkThread(ctx, parentThread.ThreadID, "parent")
if err != nil {
    log.Fatal(err)
}

// Link to related thread
err = thread.LinkThread(ctx, relatedThread.ThreadID, "related")
if err != nil {
    log.Fatal(err)
}

// Link to child thread
err = parentThread.LinkThread(ctx, childThread.ThreadID, "child")
if err != nil {
    log.Fatal(err)
}
```

</CodeGroup>

### Relationship Types

| Type | Description |
|------|-------------|
| `parent` | Parent thread that spawned this workflow |
| `child` | Child thread for sub-processes |
| `related` | Parallel or dependent workflow |
| `followup` | Continuation of a previous thread |

### Use Cases

#### Customer Support
- Support agent gets ticket: "Where's my order?"
- Query by order ID → Find thread → Show complete execution

#### Operations
- Monitor specific high-value orders
- Track problematic customer accounts
- Investigate transaction failures

#### Analytics
- Correlate thread data with business metrics
- Link execution patterns to customer behavior

### Best Practices

- **Add early** - Add references as soon as they're available
- **Use consistent keys** - Standardize reference names across services
- **Multiple references** - Add all relevant identifiers
- **Business context** - Use IDs that teams already recognize

### Next Steps

<CardGroup cols={2}>
  <Card title="Using Sub-steps" icon="list-tree" href="/core-concepts/using-sub-steps">
    Break down complex operations
  </Card>
  <Card title="Getting Threads" icon="database" href="/core-concepts/data-retrieval/getting-threads">
    Query workflow data
  </Card>
</CardGroup>
